<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"simuty.com","root":"/","scheme":"Gemini","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"path":"search.xml"};
  </script>

  <meta name="description" content="å­¦æ‰€ä»¥ç›Šæ‰ä¹Ÿï¼Œç ºæ‰€ä»¥è‡´åˆƒä¹Ÿã€‚ï¼ˆã€Šè¯´è‹‘Â·å»ºæœ¬ã€‹ï¼‰">
<meta property="og:type" content="article">
<meta property="og:title" content="Kafkaç³»åˆ—ä¸€">
<meta property="og:url" content="https://simuty.com/2020/11/02/kafka_1/index.html">
<meta property="og:site_name" content="ç®€å•å³æ˜¯ç¾">
<meta property="og:description" content="å­¦æ‰€ä»¥ç›Šæ‰ä¹Ÿï¼Œç ºæ‰€ä»¥è‡´åˆƒä¹Ÿã€‚ï¼ˆã€Šè¯´è‹‘Â·å»ºæœ¬ã€‹ï¼‰">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://simuty.com/images/photos/2020/045.jpg">
<meta property="og:image" content="https://simuty.com/2020/11/02/kafka_1/007.png">
<meta property="og:image" content="https://simuty.com/2020/11/02/kafka_1/008.png">
<meta property="og:image" content="https://simuty.com/2020/11/02/kafka_1/009.png">
<meta property="article:published_time" content="2020-11-02T14:22:22.000Z">
<meta property="article:modified_time" content="2020-12-08T08:58:27.154Z">
<meta property="article:author" content="Howard">
<meta property="article:tag" content="Kafka">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://simuty.com/images/photos/2020/045.jpg">

<link rel="canonical" href="https://simuty.com/2020/11/02/kafka_1/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Kafkaç³»åˆ—ä¸€ | ç®€å•å³æ˜¯ç¾</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168603273-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-168603273-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7b295d599a09ce76e6f5d95b315b3519";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ç®€å•å³æ˜¯ç¾</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#èµ·æ­¥"><span class="nav-number">2.</span> <span class="nav-text">èµ·æ­¥</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#kafka-åŸºæœ¬æ¦‚å¿µ"><span class="nav-number">2.1.</span> <span class="nav-text">kafka åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kafka-ä¸-Zookeeper"><span class="nav-number">2.2.</span> <span class="nav-text">kafka ä¸ Zookeeper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®šä½"><span class="nav-number">2.3.</span> <span class="nav-text">å®šä½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#éƒ¨ç½²æ–¹æ¡ˆ"><span class="nav-number">2.4.</span> <span class="nav-text">éƒ¨ç½²æ–¹æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ“ä½œç³»ç»Ÿ"><span class="nav-number">2.4.1.</span> <span class="nav-text">æ“ä½œç³»ç»Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç£ç›˜å®¹é‡"><span class="nav-number">2.4.2.</span> <span class="nav-text">ç£ç›˜å®¹é‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¸¦å®½"><span class="nav-number">2.4.3.</span> <span class="nav-text">å¸¦å®½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é…ç½®"><span class="nav-number">2.4.4.</span> <span class="nav-text">é…ç½®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é—®é¢˜æ±‡æ€»"><span class="nav-number">2.5.</span> <span class="nav-text">é—®é¢˜æ±‡æ€»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">2.6.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Howard</p>
  <div class="site-description" itemprop="description">è®°å½•ç‚¹æ»´ã€åˆ†äº«æ‰€å¾—</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">64</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/simuty" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;simuty" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="reading-progress-bar"></div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2020/11/02/kafka_1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="è®°å½•ç‚¹æ»´ã€åˆ†äº«æ‰€å¾—">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç®€å•å³æ˜¯ç¾">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kafkaç³»åˆ—ä¸€
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-11-02 22:22:22" itemprop="dateCreated datePublished" datetime="2020-11-02T22:22:22+08:00">2020-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-12-08 16:58:27" itemprop="dateModified" datetime="2020-12-08T16:58:27+08:00">2020-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MQ/" itemprop="url" rel="index"><span itemprop="name">MQ</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>5.7k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <img data-src="../../../../images/photos/2020/045.jpg" width=80% />

<span class='geyan'>
å­¦æ‰€ä»¥ç›Šæ‰ä¹Ÿï¼Œç ºæ‰€ä»¥è‡´åˆƒä¹Ÿã€‚ï¼ˆã€Šè¯´è‹‘Â·å»ºæœ¬ã€‹ï¼‰
</span>
<a id="more"></a>



<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><div class="note danger">

<blockquote>
<p>åˆšå­¦äº†rabbitmq, æ€ä¹ˆçªç„¶åˆå¼€å§‹äº†kafka?</p>
</blockquote>
<ol>
<li>è‰ºå¤šä¸å‹èº«   &lt;æ‘¸ç€æ¸æ¸ç¨€ç–çš„å¤´å‘&gt;</li>
<li><strong>åªæœ‰å¯¹æ¯”æ‰èƒ½æœ‰æ›´æ·±çš„ç†è§£</strong></li>
<li>èµ·äºä¸“ä¸šï¼Œç»ˆäºä¸“ä¸š</li>
</ol>
</div>

<h2 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h2><p>çŸ¥ä¹ä¸Š<a href="https://www.zhihu.com/question/56172498" target="_blank" rel="noopener">kafka æ¨èä¹¦ç±ï¼Ÿ</a>ï¼Œå…¶ä¸­åˆ—å‡ºæ¥äº†å¤§ç¥çš„ä¹¦ç±ã€åšå®¢ï¼Œç«™åœ¨å¤§ä½¬çš„è‚©è†€ä¸Šï¼ŒåŠªåŠ›å‘å‰ï¼</p>
<p>æ‘˜å½•ä¸‹</p>
<ol>
<li><a href="https://kafka.apache.org/documentation/" target="_blank" rel="noopener"> Apache Kafka å®˜ç½‘</a></li>
<li><a href="https://stackoverflow.com/questions/tagged/apache-kafka?sort=newest&pageSize=15" target="_blank" rel="noopener">StackOverflow: Newest &#x27;apache-kafka&#x27; Questions</a></li>
<li><a href="https://blog.csdn.net/lizhitao/article/details/39499283" target="_blank" rel="noopener">ç¾å›¢æå¿—æ¶›åšå®¢</a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//www.cnblogs.com/huxi2b/">èƒ¡å¤• - åšå®¢å›­ â€“ã€ŠApache Kafkaå®æˆ˜ã€‹</a></li>
<li><a href="https://www.orchome.com/kafka/index" target="_blank" rel="noopener">kafkaä¸­æ–‡æ•™ç¨‹ - OrcHome</a></li>
</ol>
<p>çœ‹äº†ä¸‹<a href="https://time.geekbang.org/column/intro/100029201" target="_blank" rel="noopener">æå®¢æ—¶é—´â€”Kafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜</a>çš„ç›®å½•ä»‹ç»ï¼ŒåŠ ä¸Šå¤§ä½¬æœ‰ã€ŠApache Kafkaå®æˆ˜ã€‹ï¼Œåº”è¯¥è¿™æ ·çš„é…å¥—æ›´å…¨é¢ã€‚</p>
<p>é‚£å°±å¼€å§‹å­¦ä¹ å§ã€‚</p>
<p>Kafka æ˜¯ç”± Linkedin å…¬å¸å¼€å‘çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>åˆ†å¸ƒå¼</code>çš„ï¼Œæ”¯æŒ<code>å¤šåˆ†åŒº</code>ã€<code>å¤šå‰¯æœ¬</code>ï¼ŒåŸºäº <code>Zookeeper</code> çš„åˆ†å¸ƒå¼æ¶ˆæ¯æµå¹³å°ï¼Œå®ƒåŒæ—¶ä¹Ÿæ˜¯ä¸€æ¬¾<code>å¼€æºçš„</code>åŸºäº<strong>å‘å¸ƒè®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯å¼•æ“ç³»ç»Ÿ</strong>ã€‚</p>
<div class="note default">

<p><strong>æ¶ˆæ¯å¼•æ“ç³»ç»Ÿæ¦‚å¿µï¼š</strong></p>
<ol>
<li>ã€å®˜æ–¹ã€‘æ¶ˆæ¯å¼•æ“ç³»ç»Ÿæ˜¯ä¸€ç»„è§„èŒƒã€‚ä¼ä¸šåˆ©ç”¨è¿™ç»„è§„èŒƒåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´ä¼ é€’è¯­ ä¹‰å‡†ç¡®çš„æ¶ˆæ¯ï¼Œå®ç°æ¾è€¦åˆçš„å¼‚æ­¥å¼æ•°æ®ä¼ é€’ã€‚</li>
<li>ã€äººè¯ã€‘ç³»ç»Ÿ A å‘é€æ¶ˆæ¯ç»™æ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œç³»ç»Ÿ B ä»æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä¸­è¯»å– A å‘é€çš„æ¶ˆæ¯ã€‚</li>
</ol>
<p><strong>ç»„æˆéƒ¨åˆ†</strong></p>
<ol>
<li>æ¶ˆæ¯ï¼šjsonã€xmlã€protocol bufferç­‰</li>
<li>ä¼ è¾“åè®®; &lt;httpä¸å±äºä¼ è¾“åè®®ï¼Œå±äºç½‘ç»œåè®®&gt;<ol>
<li>ç‚¹å¯¹ç‚¹æ¨¡å‹: ä¸Šè¿°åˆ—å­ä¸­ï¼ŒA åªèƒ½è¢« B è¯»å–ã€‚</li>
<li>å‘å¸ƒ\è®¢é˜…æ¨¡å‹<ol>
<li>topicã€publisherã€subscriber</li>
<li>å¯ä»¥æœ‰å¤šä¸ªå‘å¸ƒè€…å‘ç›¸åŒçš„ä¸»é¢˜å‘å¸ƒæ¶ˆæ¯ï¼Œä¹Ÿæ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…ã€‚</li>
</ol>
</li>
</ol>
</li>
</ol>
</div>


<h3 id="kafka-åŸºæœ¬æ¦‚å¿µ"><a href="#kafka-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="kafka åŸºæœ¬æ¦‚å¿µ"></a>kafka åŸºæœ¬æ¦‚å¿µ</h3><img data-src="007.png" width=80% />

<img data-src="008.png" width=80% />


<ol>
<li>Brokerï¼šKafka é›†ç¾¤ç”±å¤šä¸ª Kafka å®ä¾‹ï¼ˆserverï¼‰ ç»„æˆï¼Œæ¯ä¸ªå®ä¾‹æ„æˆä¸€ä¸ª brokerï¼Œè¯´ç™½äº†å°±æ˜¯æœåŠ¡å™¨ï¼›</li>
<li>Producerï¼šç”Ÿäº§è€…ï¼Œå³æ¶ˆæ¯å‘é€è€…ï¼Œpush æ¶ˆæ¯åˆ° Kafka é›†ç¾¤ä¸­çš„ brokerï¼ˆå°±æ˜¯ serverï¼‰ä¸­</li>
<li>Topicï¼šä¸»é¢˜ï¼Œproducer å‘ kafka é›†ç¾¤ push çš„æ¶ˆæ¯ä¼šè¢«å½’äºæŸä¸€ç±»åˆ«ï¼Œå³Topicï¼Œè¿™æœ¬è´¨ä¸Šåªæ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œé¢å‘çš„å¯¹è±¡æ˜¯ producer å’Œ consumerï¼Œ<ol>
<li>producer åªéœ€è¦å…³æ³¨å°†æ¶ˆæ¯ push åˆ°å“ªä¸€ä¸ª Topic ä¸­ï¼Œ</li>
<li>consumer åªéœ€è¦å…³å¿ƒè‡ªå·±è®¢é˜…äº†å“ªä¸ª Topicï¼›</li>
</ol>
</li>
<li>Partitionï¼šæ¯ä¸€ä¸ª Topic åˆè¢«åˆ†ä¸ºå¤šä¸ª Partitionsï¼Œå³<strong>ç‰©ç†åˆ†åŒº</strong>ï¼›<ol>
<li>å‡ºäºè´Ÿè½½å‡è¡¡çš„è€ƒè™‘ï¼ŒåŒä¸€ä¸ª Topic çš„ Partitions åˆ†åˆ«å­˜å‚¨äº Kafka é›†ç¾¤çš„å¤šä¸ª broker ä¸Šï¼›</li>
<li>ä¸ºäº†æé«˜å¯é æ€§ï¼Œè¿™äº› Partitions å¯ä»¥ç”± Kafka æœºåˆ¶ä¸­çš„ replicas æ¥è®¾ç½®å¤‡ä»½çš„æ•°é‡ï¼›</li>
</ol>
</li>
<li>Consumerï¼šæ¶ˆè´¹è€…ï¼Œä» Kafka é›†ç¾¤çš„ broker ä¸­ pull æ¶ˆæ¯ã€æ¶ˆè´¹æ¶ˆæ¯ï¼›</li>
<li>Consumer groupï¼šhigh-level consumer API ä¸­ï¼Œæ¯ä¸ª consumer éƒ½å±äºä¸€ä¸ª consumer-groupï¼Œæ¯æ¡æ¶ˆæ¯åªèƒ½è¢« consumer-group ä¸­çš„ä¸€ä¸ª Consumer æ¶ˆè´¹ï¼Œä½†å¯ä»¥è¢«å¤šä¸ª consumer-group æ¶ˆè´¹ï¼›</li>
<li>Replicaã€‚Kafka ä¸­æ¶ˆæ¯çš„å¤‡ä»½åˆå«åšå‰¯æœ¬ï¼ˆReplicaï¼‰ï¼Œå‰¯æœ¬çš„æ•°é‡æ˜¯å¯ä»¥é…ç½®çš„ï¼ŒKafka å®šä¹‰äº†ä¸¤ç±»å‰¯æœ¬ï¼š<ol>
<li>é¢†å¯¼è€…å‰¯æœ¬ï¼ˆLeader Replicaï¼‰</li>
<li>è¿½éšè€…å‰¯æœ¬ï¼ˆFollower Replicaï¼‰</li>
<li><strong>å‰è€…å¯¹å¤–æä¾›æœåŠ¡ï¼Œåè€…åªæ˜¯è¢«åŠ¨è·Ÿéš</strong></li>
</ol>
</li>
<li>Offsetï¼š æ¶ˆæ¯ä½ç§»ï¼Œ è¡¨ç¤ºåˆ†åŒºä¸­æ¯æ¡æ¶ˆæ¯çš„ä½ç½®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªå•è°ƒé€’å¢ä¸”ä¸å˜çš„å€¼</li>
<li>Consumer Offsetï¼š æ¶ˆè´¹è€…ä½ç§»ï¼Œè¡¨å¾æ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰è‡ªå·±çš„æ¶ˆè´¹è€…ä½ç§»ã€‚</li>
<li>ZooKeeperï¼šKafka é€šè¿‡ ZooKeeper æ¥å­˜å‚¨é›†ç¾¤çš„ meta ä¿¡æ¯ç­‰ï¼›</li>
</ol>
<h3 id="kafka-ä¸-Zookeeper"><a href="#kafka-ä¸-Zookeeper" class="headerlink" title="kafka ä¸ Zookeeper"></a>kafka ä¸ Zookeeper</h3><p>Kafkaçš„æœåŠ¡å™¨ç«¯ç”±è¢«ç§°ä¸º Broker çš„æœåŠ¡è¿›ç¨‹æ„æˆï¼Œå³ä¸€ä¸ª Kafka é›†ç¾¤ç”±å¤šä¸ª Broker ç»„æˆï¼Œ<strong>Broker è´Ÿè´£æ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚</strong>ï¼Œä»¥åŠ<strong>å¯¹æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–</strong>ï¼›</p>
<blockquote>
<p>è¯¥éƒ¨åˆ†éœ€è¦ç»“åˆzk, åç»­å†å­¦ä¹ ã€‚</p>
</blockquote>
<h3 id="å®šä½"><a href="#å®šä½" class="headerlink" title="å®šä½"></a>å®šä½</h3><p>Kafkaçš„å®šä½ï¼šKafka ä¸å†æ˜¯ä¸€ä¸ªå•çº¯çš„æ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œè€Œæ˜¯èƒ½å¤Ÿå®ç°ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly-onceï¼‰å¤„ç†è¯­ä¹‰çš„å®æ—¶æµå¤„ç†å¹³å°ã€‚</p>
<ol>
<li>Apache Kafkaï¼Œä¹Ÿç§°ç¤¾åŒºç‰ˆ Kafkaã€‚ä¼˜åŠ¿åœ¨äºè¿­ä»£é€Ÿåº¦å¿«ï¼Œç¤¾åŒºå“åº”åº¦é«˜ï¼Œä½¿ç”¨å®ƒå¯ä»¥ è®©ä½ æœ‰æ›´é«˜çš„æŠŠæ§åº¦ï¼›ç¼ºé™·åœ¨äºä»…æä¾›åŸºç¡€æ ¸å¿ƒç»„ä»¶ï¼Œç¼ºå¤±ä¸€äº›é«˜çº§çš„ç‰¹æ€§ã€‚</li>
<li>Confluent Kafkaï¼ŒConfluent å…¬å¸æä¾›çš„ Kafkaã€‚ä¼˜åŠ¿åœ¨äºé›†æˆäº†å¾ˆå¤šé«˜çº§ç‰¹æ€§ä¸”ç”± Kafka åŸç­äººé©¬æ‰“é€ ï¼Œè´¨é‡ä¸Šæœ‰ä¿è¯ï¼›ç¼ºé™·åœ¨äºç›¸å…³æ–‡æ¡£èµ„æ–™ä¸å…¨ï¼Œæ™®åŠç‡è¾ƒä½ï¼Œæ²¡æœ‰å¤ª å¤šå¯ä¾›å‚è€ƒçš„èŒƒä¾‹ã€‚</li>
<li>CDH/HDP Kafkaï¼Œå¤§æ•°æ®äº‘å…¬å¸æä¾›çš„ Kafkaï¼Œå†…åµŒ Apache Kafkaã€‚ä¼˜åŠ¿åœ¨äºæ“ä½œç®€ å•ï¼ŒèŠ‚çœè¿ç»´æˆæœ¬ï¼›ç¼ºé™·åœ¨äºæŠŠæ§åº¦ä½ï¼Œæ¼”è¿›é€Ÿåº¦è¾ƒæ…¢ã€‚</li>
</ol>
<div class="note danger">

<p><strong>ç›‘æ§</strong><br>JMXTrans + InfluxDB + Grafana</p>
</div>



<h3 id="éƒ¨ç½²æ–¹æ¡ˆ"><a href="#éƒ¨ç½²æ–¹æ¡ˆ" class="headerlink" title="éƒ¨ç½²æ–¹æ¡ˆ"></a>éƒ¨ç½²æ–¹æ¡ˆ</h3><img data-src="009.png" width=80% />


<h4 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h4><div class="note danger">

<p>äº”ç§I/Oæ¨¡å‹</p>
<ol>
<li>é˜»å¡å¼ I/O</li>
<li>éé˜»å¡å¼ I/O</li>
<li>I/O å¤šè·¯å¤ç”¨ï¼š</li>
<li>ä¿¡å·é©±åŠ¨ I/O</li>
<li>å¼‚æ­¥ I/Oã€‚</li>
</ol>
<blockquote>
<p>I/O æ¨¡å‹ä¸ Kafka çš„å…³ç³»åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
</blockquote>
<div class="note info">

<p>å®é™…ä¸Š Kafka å®¢æˆ·ç«¯åº•å±‚ä½¿ç”¨äº† Java çš„ selectorï¼Œselector åœ¨ Linux ä¸Šçš„å®ç°æœºåˆ¶æ˜¯ epollï¼Œè€Œåœ¨ Windows å¹³å°ä¸Šçš„å®ç°æœºåˆ¶ æ˜¯ selectã€‚å› æ­¤åœ¨è¿™ä¸€ç‚¹ä¸Šå°† Kafka éƒ¨ç½²åœ¨ Linux ä¸Šæ˜¯æœ‰ä¼˜åŠ¿çš„ï¼Œå› ä¸ºèƒ½å¤Ÿè·å¾—æ›´é«˜æ•ˆçš„ I/O æ€§èƒ½ã€‚</p>
<p>åœ¨ Linux éƒ¨ç½² Kafka èƒ½å¤Ÿäº«å—åˆ°<strong>é›¶æ‹·è´æŠ€æœ¯</strong>æ‰€å¸¦æ¥çš„ å¿«é€Ÿæ•°æ®ä¼ è¾“ç‰¹æ€§ã€‚</p>
</div>

</div>


<h4 id="ç£ç›˜å®¹é‡"><a href="#ç£ç›˜å®¹é‡" class="headerlink" title="ç£ç›˜å®¹é‡"></a>ç£ç›˜å®¹é‡</h4><p>æ¯å¤© <strong>1 äº¿</strong>æ¡ <strong>1KB</strong> å¤§å°çš„æ¶ˆæ¯ï¼Œä¿å­˜<strong>ä¸¤ä»½</strong>ä¸”ç•™å­˜<strong>ä¸¤å‘¨</strong>çš„æ—¶é—´ï¼ŒKafka é›†ç¾¤éœ€è¦ä¸ºè¿™ä¸ªä¸šåŠ¡é¢„ ç•™å¤šå°‘ç£ç›˜ç©ºé—´å—ï¼Ÿ</p>
<div class="note success">

<ol>
<li>å•æ—¥ï¼š1 äº¿ * 1KB * 2 / 1000 / 1000 = 200GB</li>
<li>åŠ ä¸Šç´¢å¼•æ•°æ®ç­‰ï¼Œé¢„ç•™<strong>20%ç£ç›˜ç©ºé—´</strong>ï¼› 220G</li>
<li>ä¸¤å‘¨ï¼Œ220*14ï¼Œå¤§çº¦3Tï¼›</li>
<li>kafkaæ”¯æŒæ•°æ®å‹ç¼©ï¼Œ<strong>å‹ç¼©æ¯”0.75</strong>ï¼Œ æ€»çš„éœ€è¦2.25T</li>
</ol>
</div>

<div class="note primary">

<p>è€ƒè™‘çš„å› ç´ </p>
<ol>
<li>æ¶ˆæ¯æ•°é‡</li>
<li>ç•™å­˜æ—¶é—´</li>
<li>å¹³å‡æ¶ˆæ¯å¤§å°</li>
<li>å¤‡ä»½æ•°é‡</li>
<li>æ˜¯å¦å¯ç”¨å‹ç¼©</li>
</ol>
</div>



<h4 id="å¸¦å®½"><a href="#å¸¦å®½" class="headerlink" title="å¸¦å®½"></a>å¸¦å®½</h4><div class="note info">

<p>å‡è®¾ä½ å…¬å¸çš„æœºæˆ¿ç¯å¢ƒæ˜¯<code>åƒå…†ç½‘ç»œ</code>ï¼Œå³ <code>1Gbps</code>ï¼Œç°åœ¨ä½ æœ‰ä¸ªä¸šåŠ¡ï¼Œå…¶ä¸šåŠ¡ç›®æ ‡æˆ– SLA æ˜¯åœ¨ <strong>1 å°æ—¶å†…å¤„ ç† 1TB çš„ä¸šåŠ¡æ•°æ®</strong>ã€‚éœ€è¦å¤šå°‘å° Kafka æœåŠ¡å™¨æ¥å®Œæˆè¿™ä¸ªä¸šåŠ¡å‘¢ï¼Ÿ</p>
<div class="note danger">

<ol>
<li>1Gbps, æ¯ç§’å¤„ç† 1Gb çš„æ•°æ®;</li>
<li>å•å°KafkaæœåŠ¡ç”¨<strong>70%</strong> å¸¦å®½ï¼›ä¹Ÿå°±æ˜¯<strong>700Mbï¼›ã€æœ€å¤§ã€‘</strong></li>
<li>1Tä¸€å°æ—¶ï¼Œæ¯ç§’ 1000*1000/3600 = 277ï¼›</li>
<li>ä½†<strong>å¸¦å®½èµ„æº Mbps è€Œä¸æ˜¯ MBps, éœ€è¦ä¹˜ä»¥8ï¼Œç­‰äº2300+</strong></li>
<li>2336/240ï¼Œ çº¦ç­‰äº10å°æœºå™¨</li>
<li>å¦‚æœéœ€è¦<strong>å¤‡ä»½ä¸¤ä»½</strong>ï¼Œä¹˜ä»¥3ï¼Œå³<strong>30å°</strong></li>
</ol>
</div>

</div>


<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><div class="note danger">

<p><strong>Broker é…ç½®</strong></p>
<ol>
<li>log.dirsï¼šä¸€å®šè¦é…ç½®<strong>å¤šä¸ªè·¯å¾„</strong>ï¼Œæ ¼å¼ä¸ºCSVï¼›</li>
<li>log.dirï¼šè¡¥å……ä¸Šä¸€ä¸ªå‚æ•°çš„ï¼›</div>


</li>
</ol>
<div class="note default">

<p><strong>ZooKeeper é…ç½®</strong></p>
<ol>
<li>zookeeper.connect: ğŸš©CSV æ ¼å¼çš„å‚æ•°ï¼Œæ¯” å¦‚æˆ‘å¯ä»¥æŒ‡å®šå®ƒçš„å€¼ä¸º zk1:2181,zk2:2181,zk3:2181</li>
</ol>
<div class="note success">

<p>ä½ æœ‰ä¸¤å¥— Kafka é›†ç¾¤ï¼Œå‡è®¾åˆ†åˆ«å«å®ƒä»¬ kafka1 å’Œ kafka2ï¼Œé‚£ä¹ˆä¸¤å¥—é›†ç¾¤çš„zookeeper.connectå‚æ•°å¯ä»¥ è¿™æ ·æŒ‡å®šï¼š</p>
<p>zk1:2181,zk2:2181,zk3:2181/kafka1<br>zk1:2181,zk2:2181,zk3:2181/kafka2ã€‚</p>
<p>åˆ‡è®° <strong>chroot</strong> [åˆ«å]åªéœ€è¦å†™ä¸€æ¬¡ï¼Œè€Œä¸”æ˜¯åŠ åˆ°æœ€åçš„</p>
</div>

</div>

<div class="note primary">

<p><strong>ä¸ Broker è¿æ¥é…ç½®</strong></p>
<ol>
<li>listenersï¼šå­¦åå«ç›‘å¬å™¨, å¯¹å†…ï¼Œå†…ç½‘è®¿é—®ï¼Œè¿™ä¸ªå°±è¡Œäº†ã€‚</li>
<li>advertised.listenersï¼šè¿™ç»„ç›‘å¬å™¨æ˜¯ Broker ç”¨äºå¯¹å¤–å‘å¸ƒçš„</li>
<li>listener.security.protocol.mapï¼š å‘Šè¯‰è¿™ä¸ªåè®® åº•å±‚ä½¿ç”¨äº†å“ªç§å®‰å…¨åè®®ï¼›</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ”¹å˜å½“å‰broker 0ä¸Šçš„log cleaner threadså¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤å®ç°ï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-configs.sh --bootstrap-server localhost:9092 --entity-type brokers --entity-name 0 --alter --add-config log.cleaner.threads&#x3D;2</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å½“å‰broker 0çš„åŠ¨æ€é…ç½®å‚æ•°ï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-configs.sh --bootstrap-server localhost:9092 --entity-type brokers --entity-name 0 --describe</span><br><span class="line"></span><br><span class="line">åˆ é™¤broker idä¸º0çš„serverä¸Šçš„é…ç½®å‚æ•°&#x2F;è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-configs.sh --bootstrap-server localhost:9092 --entity-type brokers --entity-name 0 --alter --delete-config log.cleaner.threads</span><br><span class="line"></span><br><span class="line">åŒæ—¶æ›´æ–°é›†ç¾¤ä¸Šæ‰€æœ‰brokerä¸Šçš„å‚æ•°ï¼ˆcluster-wideç±»å‹ï¼Œä¿æŒæ‰€æœ‰brokersä¸Šå‚æ•°çš„ä¸€è‡´æ€§ï¼‰ï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-configs.sh --bootstrap-server localhost:9092 --entity-type brokers --entity-default --alter --add-config log.cleaner.threads&#x3D;2</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å½“å‰é›†ç¾¤ä¸­åŠ¨æ€çš„cluster-wideç±»å‹çš„å‚æ•°åˆ—è¡¨ï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-configs.sh --bootstrap-server localhost:9092 --entity-type brokers --entity-default --describe</span><br></pre></td></tr></table></figure>

</div>


<div class="note success">

<p><strong>Topic ç®¡ç†</strong></p>
<ol>
<li>auto.create.topics.enableï¼šfalse, æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topicã€‚å»ºè®®ï¼šfalse, é˜²æ­¢ç–å¿½åˆ›å»ºtopic;</li>
<li>unclean.leader.election.enableï¼šæ˜¯å¦å…è®¸ Unclean Leader é€‰ä¸¾ã€‚å»ºè®®false, ä¸è®©è½åå¤ªå¤šçš„å‰¯æœ¬å½“é€‰leaderï¼›</li>
<li>auto.leader.rebalance.enableï¼šæ˜¯å¦å…è®¸å®šæœŸè¿› è¡Œ Leader é€‰ä¸¾ã€‚falseï¼Œæ²¡å¿…è¦æ²¡äº‹<strong>æ¢</strong>leaderï¼Œå³ä¾¿åŸæ¥çš„leaderæ­£å¸¸ä¹Ÿä¼šå®š<strong>æœŸæ¢ï¼Œ</strong>æ²¡æœ‰å¿…è¦ã€‚</li>
</ol>
<div class="note danger">

<p><strong>Topic çº§åˆ«å‚æ•°</strong><br>Topic çº§åˆ«å‚æ•°ä¼šè¦†ç›–å…¨å±€ Broker å‚æ•°çš„å€¼ï¼Œè€Œæ¯ä¸ª Topic éƒ½èƒ½è®¾ç½®è‡ªå·±çš„å‚æ•°å€¼ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ Topic çº§åˆ«å‚æ•°.</p>
<p>retention.msï¼šè§„å®šäº†è¯¥ Topic æ¶ˆæ¯è¢«ä¿å­˜çš„æ—¶é•¿ã€‚ é»˜è®¤æ˜¯ 7 å¤©ï¼Œå³è¯¥ Topic åªä¿å­˜æœ€è¿‘ 7 å¤©çš„æ¶ˆæ¯<br>retention.bytesï¼šè§„å®šäº†è¦ä¸ºè¯¥ Topic é¢„ç•™å¤šå¤§çš„ç£ç›˜ç©ºé—´ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¯åœ¨åˆ›å»ºtopicæ—¶ï¼Œé€šè¿‡--configè¿›è¡ŒæŒ‡å®šé¡¹çš„å‚æ•°é…ç½®ï¼Œè¦†ç›–é»˜è®¤é…ç½®ï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-topics.sh --zookeeper localhost:2181 --create --topic my-topic --partitions 1 --replication-factor 1 --config max.message.bytes&#x3D;1000000 --config flush.messages&#x3D;1</span><br><span class="line"></span><br><span class="line">ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºtopicä¹‹åé€šè¿‡config.shæ–‡ä»¶å¯¹å…¶ä¸­çš„ç‰¹å®šæŒ‡æ ‡è¿›è¡Œä¿®æ”¹ï¼Œä¸‹é¢æ“ä½œå¯¹my-topicç›¸å…³æŒ‡æ ‡è¿›è¡Œé…ç½®ï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-configs.sh --zookeeper localhost:2181 --entity-type topics --entity-name my-topic --alter --add-config max.message.bytes&#x3D;1000000</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-configs.sh --zookeeper localhost:2181 --entity-type topics --entity-name my-topic --describe</span><br><span class="line"></span><br><span class="line">ä¹Ÿå¯ä»¥æ’¤é”€&#x2F;åˆ é™¤æŸäº›æŒ‡å®šé…ç½®ï¼Œå°†è¯¥é¡¹é‡ç½®ä¸ºé»˜è®¤é…ç½®ï¼š</span><br><span class="line">&gt; bin&#x2F;kafka-configs.sh --zookeeper localhost:2181 --entity-type topics --entity-name my-topic --alter --delete-config max.message.bytes</span><br></pre></td></tr></table></figure>

</div>

</div>


<div class="note warning">

<p><strong>æ•°æ®ç•™å­˜</strong></p>
<ol>
<li>log.retention.{hour|minutes|ms}: æ§åˆ¶ä¸€æ¡æ¶ˆæ¯æ•°æ®è¢«ä¿å­˜å¤šé•¿æ—¶é—´; hourå¤šä¸€äº›</li>
<li>log.retention.bytesï¼šè¿™æ˜¯æŒ‡å®š Broker ä¸ºæ¶ˆæ¯ä¿å­˜ çš„æ€»ç£ç›˜å®¹é‡å¤§å°ã€‚ï¼š-1æ— é™åˆ¶ï¼Œè‡ªè¡Œè®¾ç½®å°±è¡Œ</li>
<li>message.max.bytesï¼šæ§åˆ¶ Broker èƒ½å¤Ÿæ¥æ”¶çš„æœ€å¤§æ¶ˆ æ¯å¤§å°ã€‚é»˜è®¤1000012ï¼Œ 1Mï¼Œå¤ªå°ï¼Œåªæ˜¯ä¸€ä¸ªåº¦é‡å°ºï¼›å¯ä»¥é€‚å½“è®¾ç½®å¤§ä¸€äº›ã€‚</li>
</ol>
</div>


<div class="note danger">

<p><strong>æ“ä½œç³»ç»Ÿå‚æ•°</strong></p>
<ol>
<li>æ–‡ä»¶æè¿°ç¬¦é™åˆ¶: ulimit -n 1000000, è®¾ç½®è¿™ä¸ªå‚æ•°ä¸€ ç‚¹éƒ½ä¸é‡è¦ï¼Œä½†ä¸è®¾ç½®çš„è¯åæœå¾ˆä¸¥é‡ï¼Œæ¯”å¦‚ä½ ä¼šç»å¸¸çœ‹ åˆ°â€œToo many open filesâ€çš„é”™è¯¯ã€‚</li>
<li>æ–‡ä»¶ç³»ç»Ÿç±»å‹: XFS çš„æ€§èƒ½è¦å¼ºäº ext4ï¼Œ</li>
<li>Swappiness: ç½‘ä¸Šå¾ˆå¤šæ–‡ç« éƒ½æåˆ°è®¾ç½®å…¶ä¸º 0ï¼Œå°† swap å®Œå…¨ç¦æ‰ä»¥é˜²æ­¢ Kafka è¿›ç¨‹ä½¿ç”¨ swap ç©ºé—´ã€‚æˆ‘ä¸ªäºº åå€’è§‰å¾—è¿˜æ˜¯ä¸è¦è®¾ç½®æˆ 0 æ¯”è¾ƒå¥½ï¼Œè®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå°çš„å€¼ï¼Œå½“å¼€å§‹ä½¿ç”¨ swap ç©ºé—´æ—¶ï¼Œä½ è‡³å°‘ èƒ½å¤Ÿè§‚æµ‹åˆ° Broker æ€§èƒ½å¼€å§‹å‡ºç°æ€¥å‰§ä¸‹é™ï¼Œä»è€Œç»™ä½ è¿›ä¸€ æ­¥è°ƒä¼˜å’Œè¯Šæ–­é—®é¢˜çš„æ—¶é—´, æ¯”å¦‚ï¼š1</li>
<li>æäº¤æ—¶é—´ï¼šé»˜è®¤æ˜¯ 5 ç§’ã€‚å‘ Kafka å‘é€ æ•°æ®å¹¶ä¸æ˜¯çœŸè¦ç­‰æ•°æ®è¢«å†™å…¥ç£ç›˜æ‰ä¼šè®¤ä¸ºæˆåŠŸï¼Œè€Œæ˜¯åªè¦ æ•°æ®è¢«å†™å…¥åˆ°æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ï¼ˆPage Cacheï¼‰ä¸Šå°±å¯ä»¥ äº†ï¼Œéšåæ“ä½œç³»ç»Ÿæ ¹æ® LRU ç®—æ³•ä¼šå®šæœŸå°†é¡µç¼“å­˜ä¸Š çš„â€œè„â€æ•°æ®è½ç›˜åˆ°ç‰©ç†ç£ç›˜ä¸Š</li>
</ol>
</div>





<h3 id="é—®é¢˜æ±‡æ€»"><a href="#é—®é¢˜æ±‡æ€»" class="headerlink" title="é—®é¢˜æ±‡æ€»"></a>é—®é¢˜æ±‡æ€»</h3><p>é—®é¢˜æ‘˜å½•â€“<a href="https://time.geekbang.org/column/intro/100029201" target="_blank" rel="noopener">æå®¢æ—¶é—´â€”Kafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜</a></p>
<div class="note success">

<ol>
<li>Aç³»ç»Ÿä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æŠŠæ¶ˆæ¯å‘é€ç»™Bç³»ç»Ÿï¼Ÿ<ol>
<li>å‰Šå³°å¡«è°·ï¼Œé¿å…é›ªå´©ã€‚</li>
<li>ä¸Šæ¸¸æ¥å—è®¢å•ï¼Œä¸‹æ¸¸å¤„ç†ï¼Œç»“æœé›ªå´©äº†ï¼›<ol>
<li><strong>å¯¹ä¸Šæ¸¸é™é€Ÿä¸åˆç†</strong>ï¼Œé—®é¢˜ä¸åœ¨ä¸Šæ¸¸ï¼Œé‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œ<strong>è§£è€¦ã€å‰Šå³°å¡«è°·</strong></div>


</li>
</ol>
</li>
</ol>
</li>
</ol>
<div class="note info">
mqå’Œrpcè°ƒç”¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

<div class="note primary">

<p>å¸¸è§çš„æ•°æ®æµæœ‰ä¸‰ç§ï¼š</p>
<ol>
<li>é€šè¿‡æ•°æ®åº“ï¼›</li>
<li>é€šè¿‡æœåŠ¡è°ƒç”¨ï¼ˆREST/RPCï¼‰; </li>
<li>é€šè¿‡å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ï¼ˆæ¶ˆæ¯å¼•æ“ï¼Œå¦‚ Kafkaï¼‰</li>
</ol>
</div>

<ol>
<li>MQæœ‰è‡ªå·±çš„bufferï¼Œèƒ½å¤Ÿå¯¹æŠ—è¿‡è½½ï¼ˆoverloadedï¼‰å’Œä¸å¯ç”¨åœºæ™¯</li>
<li>MQæ”¯æŒé‡è¯•</li>
<li>å…è®¸å‘å¸ƒ/è®¢é˜…æ¨¡å¼</li>
<li>RPCæ˜¯ä»‹äºé€šè¿‡æ•°æ®åº“å’Œé€šè¿‡MQä¹‹é—´çš„æ•°æ®æµæ¨¡å¼ã€‚</li>
</ol>
</div>





<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.zhihu.com/question/56172498" target="_blank" rel="noopener">kafka æ¨èä¹¦ç±ï¼Ÿ</a><br><a href="https://kafka.apachecn.org/documentation.html#introduction" target="_blank" rel="noopener">kafka ä¸­æ–‡æ–‡æ¡£</a><br><a href="https://gitbook.cn/books/5ae1e77197c22f130e67ec4e/index.html" target="_blank" rel="noopener">æ·±å…¥æµ…å‡ºç†è§£åŸºäº Kafka å’Œ ZooKeeper çš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—</a></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Howard
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://simuty.com/2020/11/02/kafka_1/" title="Kafkaç³»åˆ—ä¸€">https://simuty.com/2020/11/02/kafka_1/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Kafka/" rel="tag"># Kafka</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/10/30/RabbitMQ_4/" rel="prev" title="Node&RabbitMQç³»åˆ—å›› Xåœºæ™¯è§£æ„">
      <i class="fa fa-chevron-left"></i> Node&RabbitMQç³»åˆ—å›› Xåœºæ™¯è§£æ„
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/03/kafka_2/" rel="next" title="Kafkaç³»åˆ—äºŒ">
      Kafkaç³»åˆ—äºŒ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Howard</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">294k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">4:28</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>




  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-firestore.js"></script>
  <script>
    firebase.initializeApp({
      apiKey   : 'AIzaSyAw-MAkCIHtrUzbfhgfXaE2q2QCCJDTbAY',
      projectId: 'blog-bcc62'
    });

    function getCount(doc, increaseCount) {
      // IncreaseCount will be false when not in article page
      return doc.get().then(d => {
        var count = 0;
        if (!d.exists) { // Has no data, initialize count
          if (increaseCount) {
            doc.set({
              count: 1
            });
            count = 1;
          }
        } else { // Has data
          count = d.data().count;
          if (increaseCount) {
            // If first view this article
            doc.set({ // Increase count
              count: count + 1
            });
            count++;
          }
        }

        return count;
      });
    }

    function appendCountTo(el) {
      return count => {
        el.innerText = count;
      }
    }
  </script>
  <script>
    (function() {
      var db = firebase.firestore();
      var articles = db.collection('articles');

      if (CONFIG.page.isPost) { // Is article page
        var title = document.querySelector('.post-title').innerText.trim();
        var doc = articles.doc(title);
        var increaseCount = CONFIG.hostname === location.hostname;
        if (localStorage.getItem(title)) {
          increaseCount = false;
        } else {
          // Mark as visited
          localStorage.setItem(title, true);
        }
        getCount(doc, increaseCount).then(appendCountTo(document.querySelector('.firestore-visitors-count')));
      } else if (CONFIG.page.isHome) { // Is index page
        var promises = [...document.querySelectorAll('.post-title')].map(element => {
          var title = element.innerText.trim();
          var doc = articles.doc(title);
          return getCount(doc);
        });
        Promise.all(promises).then(counts => {
          var metas = document.querySelectorAll('.firestore-visitors-count');
          counts.forEach((val, idx) => {
            appendCountTo(metas[idx])(val);
          });
        });
      }
    })();
  </script>




      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'f88581d92eb32794b280',
      clientSecret: '6d2e34f93d6b826420cf3cfe9ab04f736dd78ae6',
      repo        : 'simutyComment',
      owner       : 'simuty',
      admin       : ['simuty'],
      id          : 'f14d53a8f758b38f2734a479c388c9e7',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
