<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"simuty.com","root":"/","scheme":"Gemini","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="React实战系列-网易音乐&lt;1&gt;">
<meta property="og:url" content="https://simuty.com/2020/04/15/music_one/index.html">
<meta property="og:site_name" content="简单即是美">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://simuty.com/images/photos/2020/006.jpg">
<meta property="og:image" content="https://simuty.com/2020/04/15/music_one/09.png">
<meta property="og:image" content="https://simuty.com/2020/04/15/music_one/10.png">
<meta property="og:image" content="https://simuty.com/2020/04/15/music_one/04.gif">
<meta property="og:image" content="https://simuty.com/2020/04/15/music_one/03.png">
<meta property="og:image" content="https://simuty.com/2020/04/15/music_one/05.jpg">
<meta property="og:image" content="https://simuty.com/2020/04/15/music_one/06.jpg">
<meta property="og:image" content="https://simuty.com/2020/04/15/music_one/07.jpg">
<meta property="og:image" content="https://simuty.com/2020/04/15/music_one/08.jpg">
<meta property="article:published_time" content="2020-04-15T10:13:32.000Z">
<meta property="article:modified_time" content="2020-05-29T03:48:02.000Z">
<meta property="article:author" content="Howard">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Redux">
<meta property="article:tag" content="Immer">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://simuty.com/images/photos/2020/006.jpg">

<link rel="canonical" href="https://simuty.com/2020/04/15/music_one/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>React实战系列-网易音乐<1> | 简单即是美</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168603273-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-168603273-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7b295d599a09ce76e6f5d95b315b3519";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">简单即是美</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第一部分-初始化"><span class="nav-number">1.</span> <span class="nav-text">第一部分 初始化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#构建项目以及目录结构"><span class="nav-number">1.1.</span> <span class="nav-text">构建项目以及目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二部分-让框架跑起来"><span class="nav-number">1.2.</span> <span class="nav-text">第二部分 让框架跑起来</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#router-config"><span class="nav-number">1.2.1.</span> <span class="nav-text">router-config</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#react-router-config究竟做了什么？"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">react-router-config究竟做了什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注意事项"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Component-VS-PureComponent-VS-memo"><span class="nav-number">1.2.2.</span> <span class="nav-text">Component VS  PureComponent VS memo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Component-VS-PureComponent"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">Component VS  PureComponent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PureComponent-VS-memo"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">PureComponent VS memo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#redux-devtools-extension-调试工具"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">redux-devtools-extension 调试工具</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三部分-数据链路"><span class="nav-number">1.3.</span> <span class="nav-text">第三部分 数据链路</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#react-amp-redux-amp-react-redux"><span class="nav-number">1.3.1.</span> <span class="nav-text">react &amp; redux &amp; react-redux</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#三者之间的关系"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">三者之间的关系</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redux-thunk"><span class="nav-number">1.3.2.</span> <span class="nav-text">redux-thunk</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第四部分-注意事项⚠️"><span class="nav-number">1.4.</span> <span class="nav-text">第四部分 注意事项⚠️</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Howard</p>
  <div class="site-description" itemprop="description">记录点滴、分享所得</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">106</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/simuty" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;simuty" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="reading-progress-bar"></div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://simuty.com/2020/04/15/music_one/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard">
      <meta itemprop="description" content="记录点滴、分享所得">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简单即是美">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          React实战系列-网易音乐<1>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-15 18:13:32" itemprop="dateCreated datePublished" datetime="2020-04-15T18:13:32+08:00">2020-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-29 11:48:02" itemprop="dateModified" datetime="2020-05-29T11:48:02+08:00">2020-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="firestore-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.7k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <img data-src="../../../../images/photos/2020/006.jpg" width=80% />

<a id="more"></a>

<blockquote>
<p>声明<br>本系列参考<a href="https://juejin.im/book/5da96626e51d4524ba0fd237" target="_blank" rel="noopener">React Hooks 与 Immutable 数据流实战</a>完成，每一章节都将整合：遇到的问题、个人思考、知识点汇总等。<br>在原有代码之上进行了修改。</p>
</blockquote>
<p>目标</p>
<ol>
<li><p>本系列目标</p>
<ol>
<li><p>熟悉前端开发流程</p>
</li>
<li><p>熟练掌握一种框架目录结构，熟练使用 React+Router+Redux 相关插件</p>
</li>
<li><p>掌握Redux数据流及其相关，如immer</p>
</li>
<li><p><strong>不打算掌握布局相关</strong>，因为实例不允许。。。</p>
</li>
</ol>
</li>
<li><p>本文目标</p>
<ol>
<li><p>构建项目、目录结构划分</p>
</li>
<li><p>router-config配置、react-thunk基本使用</p>
</li>
<li><p>、PureComponent+memo+Component相关</p>
</li>
<li><p>接入redux、immer使用</p>
</li>
</ol>
</li>
</ol>
<h1 id="第一部分-初始化"><a href="#第一部分-初始化" class="headerlink" title="第一部分 初始化"></a>第一部分 初始化</h1><p>代码会放在<a href="">github</a>上，以不同的分支来区分。</p>
<blockquote>
<p>该部分不属于重点</p>
</blockquote>
<h2 id="构建项目以及目录结构"><a href="#构建项目以及目录结构" class="headerlink" title="构建项目以及目录结构"></a>构建项目以及目录结构</h2><p>采用<a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">Create React App</a>进行构建。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npx create-react-app my-app</span><br><span class="line">cd my-app</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>

<p>整理目录结构如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">├─api                   <span class="comment">// 网路请求代码、工具类函数和相关配置</span></span><br><span class="line">├─application           <span class="comment">// 项目核心功能</span></span><br><span class="line">│   └── Singers         <span class="comment">// 其中一个实例</span></span><br><span class="line">│       ├── index.js    <span class="comment">// 该路由入口文件</span></span><br><span class="line">│       ├── store       <span class="comment">// 存储相关</span></span><br><span class="line">│       │   ├── actionCreators.js   <span class="comment">// action 获取数据相关</span></span><br><span class="line">│       │   ├── constants.js    <span class="comment">// 常量</span></span><br><span class="line">│       │   ├── index.js    <span class="comment">// 导出配置</span></span><br><span class="line">│       │   └── reducer.js  <span class="comment">// reduer 接受action请求，整合数据，触发更新UI</span></span><br><span class="line">│       └── style.js</span><br><span class="line">├─assets                <span class="comment">// 字体配置及全局样式</span></span><br><span class="line">├─baseUI                <span class="comment">// 基础 UI 轮子</span></span><br><span class="line">├─components            <span class="comment">// 可复用的 UI 组件</span></span><br><span class="line">├─routes                <span class="comment">// 路由配置文件</span></span><br><span class="line">└─store                 <span class="comment">// redux 相关文件</span></span><br><span class="line">  App.js                <span class="comment">// 根组件</span></span><br><span class="line">  index.js              <span class="comment">// 入口文件</span></span><br><span class="line">  serviceWorker.js      <span class="comment">// PWA 离线应用配置</span></span><br><span class="line">  style.js              <span class="comment">// 默认样式</span></span><br></pre></td></tr></table></figure>

<p>该部分主要是采用了独立文件夹的方式存放文件、目录作用域划分等操作。属于习惯问题。</p>
<h2 id="第二部分-让框架跑起来"><a href="#第二部分-让框架跑起来" class="headerlink" title="第二部分 让框架跑起来"></a>第二部分 让框架跑起来</h2><p>该项目包含react+router+redux+dom等主要模块的引用，故，如何安排相应的模块以及配置是个问题。</p>
<h3 id="router-config"><a href="#router-config" class="headerlink" title="router-config"></a>router-config</h3><p>首先配置路由，在浏览器中可以见到不同的URL对应不同的页面，在此主要贴代码。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="comment">// 第一步，引用配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">'react-router-config'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">            &lt;HashRouter&gt;</span><br><span class="line">                &#123;renderRoutes(routes)&#125;</span><br><span class="line">            &lt;<span class="regexp">/HashRouter&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Provider&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="react-router-config究竟做了什么？"><a href="#react-router-config究竟做了什么？" class="headerlink" title="react-router-config究竟做了什么？"></a>react-router-config究竟做了什么？</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// !源码</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Switch, Route &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderRoutes</span>(<span class="params">routes, extraProps = &#123;&#125;, switchProps = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> routes ? (</span><br><span class="line">    &lt;Switch &#123;...switchProps&#125;&gt;</span><br><span class="line"><span class="comment">// !主要是这句！</span></span><br><span class="line">      &#123;routes.map(<span class="function">(<span class="params">route, i</span>) =&gt;</span> (</span><br><span class="line">        &lt;Route</span><br><span class="line">          key=&#123;route.key || i&#125;</span><br><span class="line">          path=&#123;route.path&#125;</span><br><span class="line">          exact=&#123;route.exact&#125;</span><br><span class="line">          strict=&#123;route.strict&#125;</span><br><span class="line">          render=&#123;props =&gt;</span><br><span class="line">            route.render ? (</span><br><span class="line">              route.render(&#123; ...props, ...extraProps, <span class="attr">route</span>: route &#125;)</span><br><span class="line">            ) : (</span><br><span class="line">              &lt;route.component &#123;...props&#125; &#123;...extraProps&#125; route=&#123;route&#125; /&gt;</span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">  ) : null;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default renderRoutes;</span></span><br></pre></td></tr></table></figure>

<p><strong>实例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 实例</span></span><br><span class="line"><span class="comment">// renderRoutes 这个方法只渲染一层路由, 需要在【父】【component】中加 &#123;renderRoutes(routes)&#125;</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">exact</span>: <span class="literal">true</span>, <span class="attr">render</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&#123;</span>'/<span class="attr">page1</span>'&#125; /&gt;</span></span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/page1'</span>, <span class="attr">component</span>: Page1 &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/page2'</span>,</span><br><span class="line">        component: Page2,</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">'/page2/child'</span>,</span><br><span class="line">                component: Child,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;HashRouter&gt;</span><br><span class="line">            &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">                &lt;h1&gt;Hello&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &#123;renderRoutes(routes)&#125;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/HashRouter&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li><p>renderRoutes只渲染一层，故包含子路由的需要，需要在【父】【component】中加 {renderRoutes(routes)}</p>
</li>
<li><p>哈希路由 <code>#</code>, 是否重新获取资源？</p>
</li>
</ol>
<h3 id="Component-VS-PureComponent-VS-memo"><a href="#Component-VS-PureComponent-VS-memo" class="headerlink" title="Component VS  PureComponent VS memo"></a>Component VS  PureComponent VS memo</h3><blockquote>
<p>整个部分涉及React优化性能内容</p>
</blockquote>
<p>React核心开发团队一直都努力地让React变得更快。在React中可以用来优化组件性能的方法大概有以下几种:</p>
<ol>
<li>组件懒加载(React.lazy(…)和 <Suspense />)</li>
<li>PureComponent</li>
<li>shouldComponentUpdate(…){…} 生命周期函数</li>
<li>React.memo()</li>
</ol>
<h4 id="Component-VS-PureComponent"><a href="#Component-VS-PureComponent" class="headerlink" title="Component VS  PureComponent"></a>Component VS  PureComponent</h4><ol>
<li>默认Component遇到state Props 变化时，父子组件都更新。</li>
<li>Component通过shouldComponentUpdate生命周期函数进行判断是否更新组件；</li>
<li>PureComponent组件<strong>没有</strong>shouldComponentUpdate生命周期函数，组件内部自动判断时候需要更新。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>._compositeType === CompositeTypes.PureClass) &#123;</span><br><span class="line">  shouldUpdate = !shallowEqual(prevProps, nextProps) || ! shallowEqual(inst.state, nextState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>React源码中很容易看到：shadowEqual只会”浅”检查组件的props和state，这就意味着嵌套对象和数组是不会被比较的。</p>
<p>PureComponent适合用于5展示的组件。</p>
<h4 id="PureComponent-VS-memo"><a href="#PureComponent-VS-memo" class="headerlink" title="PureComponent VS memo"></a>PureComponent VS memo</h4><p>函数组件没有state、shouldComponentUpdate，故无法采用 <strong>生命周期｜｜自动浅比较</strong>的方式。</p>
<blockquote>
<p>React v16.6 引入 React.memo()</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// !需求》：现在有一个显示时间的组件,每一秒都会重新渲染一次</span></span><br><span class="line"><span class="comment">// ?对于Child组件我们肯定不希望也跟着渲染，所有需要用到PureComponent || React.momo()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Parent</span></span><br><span class="line"><span class="keyword">import</span> React  <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            date : <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        setInterval(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                date:<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;Child seconds=&#123;<span class="number">1</span>&#125;/&gt;</span><br><span class="line">                &lt;div&gt;&#123;<span class="keyword">this</span>.state.date.toString()&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Child</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">&#123;seconds&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'I am rendering'</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;I am update every &#123;seconds&#125; seconds&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>**</span><br><span class="line"> *</span><br><span class="line"> *</span><br><span class="line"> * @param &#123;*&#125; prevProps 组件将会接收的下一个参数props</span><br><span class="line"> * @param &#123;*&#125; nextProps 组件的下一个状态state </span><br><span class="line"> * @returns</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">function areEqual(prevProps, nextProps) &#123;</span></span><br><span class="line"><span class="regexp">    if (prevProps.seconds === nextProps.seconds) &#123;</span></span><br><span class="line"><span class="regexp">        return true;</span></span><br><span class="line"><span class="regexp">    &#125; else &#123;</span></span><br><span class="line"><span class="regexp">        return false;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 第一个参数为纯函数的组件，</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 第二个参数用于对比props控制是否刷新，</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/      与shouldComponentUpdate()功能类似。</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default React.memo(Child, areEqual);</span></span><br><span class="line"><span class="regexp">/</span>* -------- React.memo ----------- *<span class="regexp">/</span></span><br></pre></td></tr></table></figure>

<p>PureComponent  🆚 VS  🆚 memo</p>
<ul>
<li>React.PureComponent是银</li>
<li>React.memo(…)是金</li>
<li>React.PureComponent是给ES6的类组件使用的</li>
<li>React.memo(…)是给函数组件使用的</li>
<li>React.PureComponent减少ES6的类组件的无用渲染</li>
<li>React.memo(…)减少函数组件的无用渲染</li>
</ul>
<h4 id="redux-devtools-extension-调试工具"><a href="#redux-devtools-extension-调试工具" class="headerlink" title="redux-devtools-extension 调试工具"></a>redux-devtools-extension 调试工具</h4><p><a href="http://extension.remotedev.io/" target="_blank" rel="noopener">redux-devtools-extension 官网</a></p>
<p><img data-src="09.png" alt="redux-devtools-extension"></p>
<p><img data-src="10.png" alt="使用说明"><br>图片来源：<a href="https://blog.csdn.net/achenyuan/article/details/80884895" target="_blank" rel="noopener">https://blog.csdn.net/achenyuan/article/details/80884895</a></p>
<h2 id="第三部分-数据链路"><a href="#第三部分-数据链路" class="headerlink" title="第三部分 数据链路"></a>第三部分 数据链路</h2><p>redux在之前的文章中已经有过学习，包含了主要的步骤以及概念。可以参考前几天的<a href="https://simuty.com/2020/04/10React%E7%B3%BB%E5%88%97-Redux/">—-React系列-Redux&lt;2&gt;</a>。</p>
<p>可以参考下册两个图，加以回忆。</p>
<p><img data-src="04.gif" alt="流程"></p>
<p><img data-src="03.png" alt="代码主要步骤"></p>
<p>按照之前的理解就可以直接上手，初始化<br>action -&gt; dispatch -&gt; reducer =&gt; new state =&gt; update UI.</p>
<p>其中有个问题，如何 <strong>高效</strong> 的处理state事关 <strong>性能优劣</strong>。前一节，对<a href="https://simuty.com/2020/04/13React%E7%B3%BB%E5%88%97-immutable%E4%B8%8A%E4%B8%8B%E6%96%87/"></a></p>
<h3 id="react-amp-redux-amp-react-redux"><a href="#react-amp-redux-amp-react-redux" class="headerlink" title="react &amp; redux &amp; react-redux"></a>react &amp; redux &amp; react-redux</h3><p>三者之间的关系可以看下册官方说明</p>
<ol>
<li>React：负责组件的UI界面渲染；</li>
<li>Redux：数据处理中心； <a href="https://redux.js.org/introduction/getting-started" target="_blank" rel="noopener">redux 官网</a></li>
<li>React-Redux：连接组件和数据中心，也就是把React和Redux联系起来。 <a href="https://react-redux.js.org/" target="_blank" rel="noopener">react-redux 官网</a></li>
</ol>
<p><img data-src="05.jpg" alt="回顾下react生命周期"></p>
<p><img data-src="06.jpg" alt="redex核心"></p>
<p><strong>React-Redux</strong></p>
<p>Redux 本身和React没有关系，只是数据处理中心，是React-Redux让他们联系在一起。</p>
<p>React-Redux提供两个方法：</p>
<ol>
<li><p>connect: connect连接React组件和Redux store。connect实际上是一个<strong>高阶函数</strong>，返回一个新的已与Redux store连接的<strong>容器组件</strong>。</p>
</li>
<li><p>Provider: 实现store的全局可访问，将store传给每个组件。<strong>原理</strong>：使用React的context，context可以实现跨组件之间的传递。</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> VisibleTodoList = connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(TodoList)</span><br></pre></td></tr></table></figure>
<p>复制代码TodoList是 <strong>UI 组件</strong>，VisibleTodoList就是由 react-redux 通过connect方法自动生成的<strong>容器组件</strong>。</p>
<ol>
<li>mapStateToProps：从Redux状态树中提取需要的部分作为props传递给当前的组件。</li>
<li>mapDispatchToProps：将需要绑定的响应事件（action）作为props传递到组件上。</li>
</ol>
<p><img data-src="07.jpg" alt="connent"></p>
<h4 id="三者之间的关系"><a href="#三者之间的关系" class="headerlink" title="三者之间的关系"></a>三者之间的关系</h4><p><img data-src="08.jpg" alt="关系"></p>
<h3 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h3><p><a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener">redux-thunk</a><br>With a plain basic Redux store, you can only do simple synchronous updates by dispatching an action. Middleware extend the store’s abilities, and let you write async logic that interacts with the store.</p>
<p>Thunks are the recommended middleware for basic Redux side effects logic, including complex synchronous logic that needs access to the store, and simple async logic like AJAX requests.</p>
<p>学习 <a href="https://zhuanlan.zhihu.com/p/85403048" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/85403048</a></p>
<h2 id="第四部分-注意事项⚠️"><a href="#第四部分-注意事项⚠️" class="headerlink" title="第四部分 注意事项⚠️"></a>第四部分 注意事项⚠️</h2><p>函数组件<code>mapStateToProps</code>拿到的数据是整个state<br>普通组件<code>mapStateToProps</code>拿到的数据是createRouter()中的reducer导出的默认值。</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Howard
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://simuty.com/2020/04/15/music_one/" title="React实战系列-网易音乐&lt;1&gt;">https://simuty.com/2020/04/15/music_one/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/React/" rel="tag"># React</a>
              <a href="/tags/Redux/" rel="tag"># Redux</a>
              <a href="/tags/Immer/" rel="tag"># Immer</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/04/14/null/" rel="prev" title="2021/01/秒杀汇总">
      <i class="fa fa-chevron-left"></i> 2021/01/秒杀汇总
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/04/16/Express_Koa_Redux_Middleware/" rel="next" title="Express Koa Redux 中间件对比">
      Express Koa Redux 中间件对比 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Howard</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">382k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:48</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>




  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-firestore.js"></script>
  <script>
    firebase.initializeApp({
      apiKey   : 'AIzaSyAw-MAkCIHtrUzbfhgfXaE2q2QCCJDTbAY',
      projectId: 'blog-bcc62'
    });

    function getCount(doc, increaseCount) {
      // IncreaseCount will be false when not in article page
      return doc.get().then(d => {
        var count = 0;
        if (!d.exists) { // Has no data, initialize count
          if (increaseCount) {
            doc.set({
              count: 1
            });
            count = 1;
          }
        } else { // Has data
          count = d.data().count;
          if (increaseCount) {
            // If first view this article
            doc.set({ // Increase count
              count: count + 1
            });
            count++;
          }
        }

        return count;
      });
    }

    function appendCountTo(el) {
      return count => {
        el.innerText = count;
      }
    }
  </script>
  <script>
    (function() {
      var db = firebase.firestore();
      var articles = db.collection('articles');

      if (CONFIG.page.isPost) { // Is article page
        var title = document.querySelector('.post-title').innerText.trim();
        var doc = articles.doc(title);
        var increaseCount = CONFIG.hostname === location.hostname;
        if (localStorage.getItem(title)) {
          increaseCount = false;
        } else {
          // Mark as visited
          localStorage.setItem(title, true);
        }
        getCount(doc, increaseCount).then(appendCountTo(document.querySelector('.firestore-visitors-count')));
      } else if (CONFIG.page.isHome) { // Is index page
        var promises = [...document.querySelectorAll('.post-title')].map(element => {
          var title = element.innerText.trim();
          var doc = articles.doc(title);
          return getCount(doc);
        });
        Promise.all(promises).then(counts => {
          var metas = document.querySelectorAll('.firestore-visitors-count');
          counts.forEach((val, idx) => {
            appendCountTo(metas[idx])(val);
          });
        });
      }
    })();
  </script>




      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'f88581d92eb32794b280',
      clientSecret: '6d2e34f93d6b826420cf3cfe9ab04f736dd78ae6',
      repo        : 'simutyComment',
      owner       : 'simuty',
      admin       : ['simuty'],
      id          : 'a482dd706e3cfd9a7bb7f709612134f9',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
